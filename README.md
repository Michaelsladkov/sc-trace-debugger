# Trace Debugger
Trace Debugger -- внутренний инструмент для команды системной верификации YSemi, который позволяет анализировать трассы исполнения системных тестов через интерфейс отладчика. Задача инстурмента в том, чтобы избавить инженеров системной верификации от просмотра текстовых трасс и дампов дизассемблера и сделать процесс отладки теста приближенным к живой отладке программы на обычном компьютере.

## Функциональность

1. Эмуляция работы теста по заранее собранной трассе

1. Возможность делать шаги вперёд и назад, просматривать значения регистров и ставить брейкпоинты в стиле Open OCD.

1. Поддержка нескольких ядер и переключения между ними

1. Чтение отладочной информации из исполняемого файла с тестом: возможность поставить брейк-поинт по номеру строки в коде и посмотреть, какой строке кода соответсвует текущий момент остановки

## Ограничения

1. Поддерживается только Unpriveleged Basic ISA RV64I

1. Не поддерживается отслеживание состояния памяти (в ближайших планах)

1. Не поддерживается состояние CSR

1. Не обрабатывается событие прерывания в трассе

## Сборка

Для сборки из исходников в системе должны быть установлены библиотеки `libelf, libdwarf`.

В проекте для тестирования используется библиотека Google Test, получаемая через FetchContent.

Для сборки необходимо выполнить команды

```
cmake --build build
cmake -B build
```

## Запуск

Для запуска CLI необходимо запустить файл `build/sc-trace-debugger`, передав аргументами командной строки путь к директории, содержащей трассы, собранные по результатам исполнения теста и путь к elf файлу теста.

## Доступные команды

В скобках указываются необязательные аргументы команд. Символом `|` обозначаются альтернативные имена или аргументы.
 
1. `hart (<hart_id>)`: без аргументов печатает список эмулируемых ядер, показывает активное, с аргументом, номером ядра, меняет активное ядро на указанное
1. `reg (<register name>)`: без аргументов печатает список доступных архитектурных регистров с их значениями в данный момент, если передано имя, печатает значение регистра с этим именем. оступны имена `x0-x31, pc`
1. `step | s`: делает шаг вперёд по трассе активного ядра
1. `step_back | sb`: делает шаг назад по трассе активного ядра
1. `run-till | rt <pc>`: запускает последовательность шагов вперёд на активном ядре до достижения указанного значения `pc`
1. `bp <addr> | <source_path:line>`: добавляет точку останова
1. `rbp <addr> | <source_path:line>`: удаляет точку останова
1. `resume | run`: запускает исполнение на всех ядрах, пока какое-либо из них не достигнет точки останова, либо все не дойдут до конца трассы
1. `line | l`: печатает путь к исходному файлу и номер строки, соответствующие `pc` активного ядра в данный момент
